---
title: "Untitled"
author: "Sahil, Ariel, Ilya, Lekha, Anthony, Trang"
date: "4/26/2021"
output: pdf_document
---


## Introduction

Anthony.

## Loading R packages

```{r}
library(foreign)
library(readxl)
library(ggplot2)
library(grid)
library(quadprog)
library(rugarch)
library(rmgarch)
library(quantmod)
library(e1071)
library(gridExtra)
library(zoo)
library(fGarch)
library(dynlm)
library(tidyverse)
library(fGarch)
library(FinTS)
theme_set(theme_bw())
```


## Formula and Basics

Anthony.

## Data description

Anthony.

```{r}

# FB data-set
fb <- getSymbols("FB", auto.assign = F)
nrow(fb) # Gives you the number of data points
fbClose <- fb$FB.Close # We can get each column by specifying the clumn name after '$' sign

# FB data-set
fb.df <- as.data.frame(fb)
fb_train_data = fb.df[1:2100,]
fb_test_data = fb.df[2100:2247,]

fb.df <- cbind(Date = rownames(fb.df), fb.df)
rownames(fb.df) <- 1:nrow(fb.df)
```


## Visualization

```{r}
# FB data-set
chartSeries(fb) # Plots the time series
```

## Analysis

```{r}
# FB data-set
#For now, I need to figure out how to name the dates column, then we can substitute "FB.Open" with "FB.Date"
fbClose_plot <- ggplot(fb.df, aes(y = FB.Close, x = Date)) + geom_line(col = 'blue', group = 1) + labs(ylab = 'return', xlab = 'Time', title = 'Adj_Close Returns')
grid.arrange(fbClose_plot, ncol = 2);
fbClose_plot
```

```{r}
# FB data-set
# Same concern, for now just try to figure out how to name "FB.Date"
```
## Model Evaluation
```{r}
# Step 1: Estimate mean equation r = beta + error
fb_data_mean <- dynlm(FB.Close ~ 1, data = fb.df)

# Step 2: Retrieve the residuals from the former model and square them
ehatsq <- ts(resid(fb_data_mean)^2)

# Step 3: regress squared residuals on one-lagged squared residuals
fb_data_arch <- dynlm(ehatsq ~ L(ehatsq), data = ehatsq)

summary(fb_data_arch)
```


```{r}
# FB data-set
fb_data_archTest <- ArchTest(fbClose, lags = 1, demean = TRUE)
fb_data_archTest

#Reject Null Hypothesis
```
Because the p-value is < 0.05, we reject the null hypothesis and conclude the presence of ARCH(1) effects.

## Prediction and Model Accuracy
```{r}
# FB data-set
head(fb.df)
fb_arch_fit <- garchFit(~garch(1,0), data = fbClose, trace = F)
summary(fb_arch_fit)
fb_pred <- predict(fb_arch_fit, n.ahead = 100, trace = TRUE, mse = c("cond","uncond"),
        plot=TRUE, nx=NULL, crit_val=NULL, conf=NULL)
summary(fb_pred)

fb.df$ht <- fb_arch_fit@h.t
# How to rename the first column as "Date"?
ggplot(fb.df, aes(y = ht, x = Date)) + geom_line(col = '#ff9933', group = 1) + ylab('Conditional Variance') + xlab('Date')
```


```{r}
# FB data-set
# We can change the armaOrder to create different models and keep the model with lowest AIC!
fb1 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)), mean.model = list(armaOrder = c(1, 1)), distribution.model = "std")

fbGarch1 <- ugarchfit(spec = fb1, data = fbClose)

fb2 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)), mean.model = list(armaOrder = c(0, 0)), distribution.model = "std")

fbGarch2 <- ugarchfit(spec = fb2, data = fbClose)

fb3 <- ugarchspec(variance.model = list(model = "sGARCH", garchOrder = c(1, 1)), mean.model = list(armaOrder = c(1, 0)), distribution.model = "std")

fbGarch3 <- ugarchfit(spec = fb3, data = fbClose)
fbGarch3
```

```{r}
# FB data-set 
# Finally forecast whatever you want!
fbPredict <- ugarchboot(fbGarch3, n.ahead = 10, method = c("Partial", "Full")[1])
plot(fbPredict, which = 2)
```

## Conclusion

Trang and Lekha

## Reference

https://rpubs.com/cyobero/arch

